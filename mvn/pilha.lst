;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;; REGISTRO DE ATIVACAO ;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

2012 0000 ; "EMPILHA>"		;	EMPILHA > ; Funçao de empilhar
; PARAMETROS DA FUNCAO EMPILHA
2002 0000 ; "END_INICIAL>"		;	END_INICIAL > ; Endereço inicial do bloco a ser empilhado
2004 0000 ; "TAMANHO>"		;	TAMANHO > ; Tamanho do bloco a ser copado


209e 0000 ; "DESEMPILHA>"		;	DESEMPILHA > ; Funcao de desempilhar

2000 0000 ; "TOPO>"		;	TOPO > ; Guarda o endereco do topo da pilha

				;	& /0000

8000 0000		;	TOPO K /0000

;=======================================================;
;====================== EMPILHA ========================;
;=======================================================;

; Parametros
8002 0000		;	END_INICIAL K /0000
8004 0000		;	TAMANHO K /0000

; Variaveis auxiliares
8006 0000		;	TAMANHO_MVN K /0000
8008 0000		;	TOPO_AUX K /0000
800a 0000		;	OLD_TOPO K /0000

; Constantes
800c 0002		;	CTE_TAMANHO K =2
800e f000		;	END K /F000
8010 0010		;	DESLOCA1 K /0010

8012 0000		;	EMPILHA JP /000
	; Multiplica o tamanho por 2
a014 8004		;		LD TAMANHO
a016 600c		;		* CTE_TAMANHO
a018 9006		;		MM TAMANHO_MVN

	; Calcula a nova posicao do topo
a01a 8000		;		LD TOPO
a01c 900a		;		MM OLD_TOPO

	; Verifica se o antigo topo nao é igual a zero
a01e 1028		;		JZ LOAD_TOPO 
a020 5006		;			- TAMANHO_MVN
a022 9000		;			MM TOPO
a024 9008		;			MM TOPO_AUX

a026 0032		;			JP INIT_COPIA
a028 5006		;		LOAD_TOPO - TAMANHO_MVN 
a02a 6010		;			* DESLOCA1 ; move pra esquerda pra tirar um F
a02c 7010		;			/ DESLOCA1 ; depois pra direita pra consertar o end
		
a02e 9000		;			MM TOPO
a030 9008		;			MM TOPO_AUX

	; Copiando os arquivos
a032 8002		;		INIT_COPIA LD END_INICIAL
a034 906a		;		MM END_BLOCO_ORIGEM

a036 8000		;		LD TOPO
a038 906c		;		MM END_BLOCO_ALVO

a03a 8004		;		LD TAMANHO
a03c 906e		;		MM TAMANHO_BLOCO

a03e a072		;		SC COPIA_BLOCO

a040 8000		;		LD TOPO
a042 400c		;		+ CTE_TAMANHO
a044 9050		;		MM END_ALVO

a046 800a		;		LD OLD_TOPO
a048 90ba		;		MM VALOR

a04a a0bc		;		SC GRAVA
a04c b012		;	RS EMPILHA

;===============================
; COPIA
;===============================

; Parametros
804e 0000		;	END_ORIGEM K /0000
8050 0000		;	END_ALVO K /0000

; Auxiliares
8052 8000		;	OP_LOAD LD /000
8054 9000		;	OP_MOVE MM /000

8056 0000		;	COPIA JP /000
	; Carrega o valor a ser copiado
a058 8052		;		LD OP_LOAD
a05a 404e		;		+ END_ORIGEM
a05c 9064		;		MM CARREGA

	; Seta o endereço alvo
a05e 8054		;		LD OP_MOVE
a060 4050		;		+ END_ALVO
a062 9066		;		MM COPEIA

	; Carrega no acumulador o valor da origem
8064 0000		;		CARREGA JP /000 ; Don't care

	; Copia o valor ao endereço alvo
8066 0000		;		COPEIA JP /000 ; Don't care
a068 b056		;	RS COPIA

;===============================
; COPIA-BLOCO
;===============================

; Parametros
806a 0000		;	END_BLOCO_ORIGEM K /0000
806c 0000		;	END_BLOCO_ALVO K /0000

806e 0000		;	TAMANHO_BLOCO K /0000

;Variaveis Auxiliares
8070 0000		;	TAMANHO_BLOCO_MVN K /0000

8072 0000		;	COPIA_BLOCO JP /000

	; Multiplica o tamanho por 2
a074 806e		;		LD TAMANHO_BLOCO
a076 600c		;		* CTE_TAMANHO
a078 9070		;		MM TAMANHO_BLOCO_MVN

	; Copiando os arquivos
a07a 8070		;		LD TAMANHO_BLOCO_MVN
a07c 109c		;		LOOP_COPIA_BLOCO JZ FIM_COPIA_BLOCO
a07e 806a		;			LD END_BLOCO_ORIGEM
a080 904e		;			MM END_ORIGEM

a082 806c		;			LD END_BLOCO_ALVO
a084 9050		;			MM END_ALVO

a086 a056		;			SC COPIA ; Chama a funçao de copia

		; Adiciona 2 aos endereços inicial e ao topo aux
a088 806a		;			LD END_BLOCO_ORIGEM
a08a 400c		;			+ CTE_TAMANHO
a08c 906a		;			MM END_BLOCO_ORIGEM

a08e 806c		;			LD END_BLOCO_ALVO
a090 400c		;			+ CTE_TAMANHO
a092 906c		;			MM END_BLOCO_ALVO

		; Diminui tamanho
a094 8070		;			LD TAMANHO_BLOCO_MVN
a096 500c		;			- CTE_TAMANHO
a098 9070		;			MM TAMANHO_BLOCO_MVN

a09a 007c		;			JP LOOP_COPIA_BLOCO
a09c b072		;		FIM_COPIA_BLOCO RS COPIA_BLOCO

;=======================================================;
;===================== DESEMPILHA ======================;
;=======================================================;

809e 0000		;	DESEMPILHA JP /000
a0a0 8000		;		LD TOPO
a0a2 400c		;		+ CTE_TAMANHO
a0a4 4052		;		+ OP_LOAD
a0a6 90a8		;		MM CG_OLD_TOPO

80a8 0000		;		CG_OLD_TOPO JP /000 ; Don't care

a0aa 9000		;		MM TOPO
a0ac b09e		;	RS DESEMPILHA

;=======================================================;
;======================= ACESSA ========================;
;=======================================================;

80ae 0000		;	ACESSA JP /000
a0b0 8052		;		LD OP_LOAD
a0b2 404e		;		+ END_ORIGEM
a0b4 90b6		;		MM JOGA_ACM

	; Joga pro acumulador o valor localizado no ponteiro do endereço de origem
80b6 0000		;		JOGA_ACM JP /000 ; Don't care
a0b8 b0ae		;	RS ACESSA

;=======================================================;
;======================= GRAVA =========================;
;=======================================================;

80ba 0000		;	VALOR K /0000 ; Valor a ser copiado

80bc 0000		;	GRAVA JP /000
	; Seta o endereço alvo
a0be 8054		;		LD OP_MOVE
a0c0 4050		;		+ END_ALVO
a0c2 90c6		;		MM COPY_VALOR

a0c4 80ba		;		LD VALOR

	; Copia o valor ao endereço alvo
80c6 0000		;		COPY_VALOR JP /000 ; Don't care
a0c8 b0bc		;	RS GRAVA

